<!DOCTYPE html>
<html>
<head>
    <title>Dashboard ANS - Intuitive Care</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
    <div id="app" class="container py-4">
        <h2 class="mb-4">ðŸ“Š Dashboard de Operadoras ANS</h2>
        
        <div class="card mb-4 p-3">
            <input v-model="busca" @input="carregarOperadoras" class="form-control" placeholder="Buscar por CNPJ ou RazÃ£o Social...">
        </div>

        <div class="row">
            <div class="col-md-8">
                <div class="card p-3">
                    <h5>Operadoras</h5>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Registro ANS</th>
                                <th>RazÃ£o Social</th>
                                <th>UF</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="op in operadoras" :key="op.RegistroANS">
                                <td>{{ op.RegistroANS }}</td>
                                <td>{{ op.RazaoSocial }}</td>
                                <td>{{ op.UF }}</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="d-flex justify-content-between">
                        <button @click="pagina--" :disabled="pagina <= 1" class="btn btn-sm btn-secondary">Anterior</button>
                        <span>PÃ¡gina {{ pagina }}</span>
                        <button @click="pagina++" class="btn btn-sm btn-secondary">PrÃ³xima</button>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card p-3">
                    <h5>Despesas por UF</h5>
                    <canvas id="meuGrafico"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue
        createApp({
            data() {
                return {
                    operadoras: [],
                    busca: '',
                    pagina: 1,
                    limit: 10
                }
            },
            watch: { pagina() { this.carregarOperadoras() } },
            methods: {
                async carregarOperadoras() {
                    const res = await fetch(`http://127.0.0.1:8000/api/operadoras?page=${this.pagina}&q=${this.busca}`);
                    const json = await res.json();
                    this.operadoras = json.data;
                },
                async carregarGrafico() {
                    const res = await fetch('http://127.0.0.1:8000/api/estatisticas');
                    const dados = await res.json();
                    const ctx = document.getElementById('meuGrafico');
                    new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: dados.map(d => d.UF),
                            datasets: [{ data: dados.map(d => d.total) }]
                        }
                    });
                }
            },
            mounted() {
                this.carregarOperadoras();
                this.carregarGrafico();
            }
        }).mount('#app')
    </script>
</body>
</html>